<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>
</head>
<body>
  <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</p>

  <script>
    const code = new URLSearchParams(window.location.search).get('code');

    const client_id = '2007408167'; // Channel ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const client_secret = 'e66fdb1ea085398114ad0c639ca4a5a9'; // üîê ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á
    const redirect_uri = 'https://trongjaitutor.github.io/line-login-form/callback.html';

    fetch('https://api.line.me/oauth2/v2.1/token', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: new URLSearchParams({
        grant_type: 'authorization_code',
        code: code,
        redirect_uri: redirect_uri,
        client_id: client_id,
        client_secret: client_secret
      })
    })
    .then(res => res.json())
    .then(tokenData => {
      const access_token = tokenData.access_token;
      return fetch('https://api.line.me/v2/profile', {
        headers: {
          Authorization: 'Bearer ' + access_token
        }
      });
    })
    .then(res => res.json())
    .then(profile => {
      const userId = profile.userId;
      // üîÑ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô FORM_ID ‡πÅ‡∏•‡∏∞ entry.123456 ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á
      const formUrl = `https://docs.google.com/forms/d/e/1FAIpQLSdMvOjeHzPJT1QDoXW76yhjcGYmzoO8kTSJPuNSAQLOD5gtew/viewform?usp=pp_url&entry.1846268970=${userId}`;
      window.location.href = formUrl;
    })
    .catch(error => {
      console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:', error);
      document.body.innerHTML = '<p>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</p>';
    });
  </script>
</body>
</html>
